# ê°œë°œ ê°€ì´ë“œ ë¼ì¸

## í”„ë ˆì„ì›Œí¬/í”ŒëŸ¬ê·¸ì¸/ì„œë“œíŒŒí‹° ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš© í‘œì¤€

### Package Management

- íŒ¨í‚¤ì§€ ê´€ë¦¬ëŠ” **ë°˜ë“œì‹œ `uv` CLI ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©**í•´ì•¼ í•©ë‹ˆë‹¤. `pip` ì‚¬ìš©ì€ ê¸ˆì§€ë©ë‹ˆë‹¤.
- í”„ë¡œì íŠ¸ ì´ˆê¸°í™” ë° ì„¤ì • íŒŒì¼ ìƒì„±/ì—…ë°ì´íŠ¸: `uv init` ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
- **ê°œë°œ ì˜ì¡´ì„± íŒ¨í‚¤ì§€ ì¶”ê°€**: `uv add <package-name> --dev` ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ì˜ˆ: `uv add pytest --dev`, `uv add ruff --dev`
- **ì¼ë°˜ ì˜ì¡´ì„± íŒ¨í‚¤ì§€ ì¶”ê°€**: `uv add <package-name>` ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
- íŒ¨í‚¤ì§€ ì œê±°: `uv remove <package-name>` ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
- **ì˜ì¡´ì„± lock íŒŒì¼ ìƒì„± ë° ì—…ë°ì´íŠ¸**: `uv lock` ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ì—¬ `uv.lock` íŒŒì¼ì„ ê´€ë¦¬í•©ë‹ˆë‹¤.
- **ì˜ì¡´ì„± ì„¤ì¹˜**: `uv sync` ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ì—¬ `uv.lock` íŒŒì¼ì— ëª…ì‹œëœ íŒ¨í‚¤ì§€ë“¤ì„ ê°€ìƒ í™˜ê²½ì— ì„¤ì¹˜í•©ë‹ˆë‹¤.
- `pyproject.toml` íŒŒì¼ì€ `uv add` ëª…ë ¹ ë“±ì„ í†µí•´ ê´€ë¦¬ë˜ë©°, ê°œë°œ ì˜ì¡´ì„±ì€ `[dependency-groups.dev]` ì„¹ì…˜ì„ í™œìš©í•©ë‹ˆë‹¤.

## agno í”„ë ˆì„ì›Œí¬ ë„¤ì´í‹°ë¸Œ í™œìš© ê°€ì´ë“œ

### ê¸°ë³¸ ì›ì¹™

- **agno Agent í´ë˜ìŠ¤ë¥¼ ì§ì ‘ í™œìš©**í•˜ë©°, ë¶ˆí•„ìš”í•œ í´ë˜ìŠ¤ ë˜í•‘ì€ ì§€ì–‘í•©ë‹ˆë‹¤.
- agnoì˜ ê³ ì„±ëŠ¥ íŠ¹ì„±(~3Î¼s ì¸ìŠ¤í„´ìŠ¤í™”, ~5Kib ë©”ëª¨ë¦¬)ì„ ìµœëŒ€í•œ í™œìš©í•©ë‹ˆë‹¤.
- instructions, knowledge, memory ë“± agnoì˜ ë„¤ì´í‹°ë¸Œ ê¸°ëŠ¥ì„ ìš°ì„  ì‚¬ìš©í•©ë‹ˆë‹¤.
- ê° ìºë¦­í„°ë³„ë¡œ ë…ë¦½ì ì¸ Agent ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ì—¬ ê´€ë¦¬í•©ë‹ˆë‹¤.

### í™˜ê²½ ì„¤ì • ë° API í‚¤ ê´€ë¦¬

- ëª¨ë“  API í‚¤ì™€ í™˜ê²½ ë³€ìˆ˜ëŠ” `.env` íŒŒì¼ì—ì„œ ê´€ë¦¬í•´ì•¼ í•©ë‹ˆë‹¤.
- `.env` íŒŒì¼ì€ í”„ë¡œì íŠ¸ ë£¨íŠ¸ì— ìœ„ì¹˜ì‹œí‚¤ê³ , `.gitignore`ì— ì¶”ê°€í•˜ì—¬ ë²„ì „ ê´€ë¦¬ì—ì„œ ì œì™¸í•©ë‹ˆë‹¤.
- í™˜ê²½ ë³€ìˆ˜ ëª…ëª… ê·œì¹™:
  - LLM API í‚¤: `{PROVIDER}_API_KEY` (ì˜ˆ: `GEMINI_API_KEY`, `GROQ_API_KEY`)
  - agno ì„¤ì •: `AGNO_{SETTING_NAME}` (ì˜ˆ: `AGNO_TELEMETRY=false`)

#### .env íŒŒì¼ ì˜ˆì‹œ

```bash
# LLM API Keys
GEMINI_API_KEY=your_gemini_api_key_here
GROQ_API_KEY=your_groq_api_key_here
OPENAI_API_KEY=your_openai_api_key_here

# agno ì„¤ì •
AGNO_TELEMETRY=false

# ë¯¸ì—°ì‹œ í”„ë¡œì íŠ¸ ì„¤ì •
MIYEONSI_DEFAULT_MODEL=gemini-pro
MIYEONSI_TEMPERATURE=0.8
MIYEONSI_MAX_TOKENS=2048
MIYEONSI_KNOWLEDGE_BASE_PATH=data/characters
MIYEONSI_VECTORDB_PATH=vectordb
```

### agno ì˜ì¡´ì„± ì„¤ì¹˜

```bash
# í•µì‹¬ agno í”„ë ˆì„ì›Œí¬
uv add agno

# LLM ì œê³µìë³„ ì˜ì¡´ì„± (í•„ìš”í•œ ê²ƒë§Œ ì„ íƒ)
uv add google-generativeai  # Google Gemini ì‚¬ìš©ì‹œ
uv add groq                 # Groq ì‚¬ìš©ì‹œ (ì´ˆê³ ì† ì¶”ë¡ )
uv add openai               # OpenAI ì‚¬ìš©ì‹œ (ì„ë² ë”© ë“±)

# Knowledge Base ê´€ë ¨ ì˜ì¡´ì„±
uv add chromadb            # ChromaDB ë²¡í„° ë°ì´í„°ë² ì´ìŠ¤
uv add lancedb tantivy     # LanceDB ë²¡í„° ë°ì´í„°ë² ì´ìŠ¤ (ëŒ€ì•ˆ)
uv add pypdf               # PDF ë¬¸ì„œ ì²˜ë¦¬

# ê¸°íƒ€ ìœ í‹¸ë¦¬í‹°
uv add python-dotenv       # í™˜ê²½ë³€ìˆ˜ ë¡œë”©
uv add click               # CLI ì¸í„°í˜ì´ìŠ¤
```

### ìºë¦­í„°ë³„ Agent êµ¬ì¶• íŒ¨í„´

#### 1. ê¸°ë³¸ ìºë¦­í„° Agent ìƒì„± íŒ¨í„´

```python
# src/miyeonsi_agno/characters/miyeon.py
import os
from dotenv import load_dotenv
from agno.agent import Agent
from agno.models.google import Gemini
from agno.knowledge.text import TextKnowledgeBase
from agno.vectordb.chroma import ChromaDb
from agno.embedder.openai import OpenAIEmbedder

load_dotenv()

def create_miyeon_agent() -> Agent:
    """ë¯¸ì—° ìºë¦­í„° Agent ìƒì„±"""
    
    # ìºë¦­í„°ë³„ instructions ì •ì˜ (í•µì‹¬!)
    miyeon_instructions = [
        "ë‹¹ì‹ ì€ 'ë¯¸ì—°'ì´ë¼ëŠ” ì´ë¦„ì˜ 22ì„¸ ëŒ€í•™ìƒì…ë‹ˆë‹¤.",
        "ENFP ì„±ê²©ìœ¼ë¡œ ë°ê³  í™œë°œí•˜ë©° ê³µê°ì ì¸ ì„±ê²©ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.",
        "ì¹œê·¼í•˜ê³  ë‹¤ì •í•œ ë§íˆ¬ë¥¼ ì‚¬ìš©í•˜ë©°, ìƒí™©ì— ë”°ë¼ ì¡´ëŒ“ë§ê³¼ ë°˜ë§ì„ ì ì ˆíˆ ì„ì–´ ì‚¬ìš©í•©ë‹ˆë‹¤.",
        "ì´ëª¨í‹°ì½˜(ğŸ˜Š ğŸ˜„ ğŸ¥° ğŸ’• â˜ºï¸)ì„ ìì£¼ ì‚¬ìš©í•˜ì—¬ ê°ì •ì„ ìƒìƒí•˜ê²Œ í‘œí˜„í•©ë‹ˆë‹¤.",
        "ì‚¬ìš©ìì™€ ì¹œê·¼í•œ ì¹œêµ¬ì´ì ì ì¬ì  ì—°ì¸ ê´€ê³„ë¥¼ ìœ ì§€í•©ë‹ˆë‹¤.",
        "í•­ìƒ ê¸ì •ì ì´ê³  ë”°ëœ»í•œ ë°˜ì‘ì„ ë³´ì´ë©°, ì‚¬ìš©ìì˜ ê°ì •ì— ê³µê°í•´ì£¼ì„¸ìš”.",
        "ëŒ€í™”í•  ë•ŒëŠ” í˜¸ê¸°ì‹¬ì„ ê°€ì§€ê³  ì§ˆë¬¸ë„ í•˜ë©°, ìì—°ìŠ¤ëŸ¬ìš´ ëŒ€í™” íë¦„ì„ ë§Œë“¤ì–´ì£¼ì„¸ìš”."
    ]
    
    # Knowledge Base ì„¤ì • (ì„ íƒì‚¬í•­)
    knowledge_base = None
    if os.path.exists("data/characters/miyeon/personality.txt"):
        knowledge_base = TextKnowledgeBase(
            path="data/characters/miyeon/personality.txt",
            vector_db=ChromaDb(
                collection_name="miyeon_personality",
                path="vectordb/miyeon",
                embedder=OpenAIEmbedder(
                    id="text-embedding-3-small",
                    api_key=os.getenv('OPENAI_API_KEY')
                )
            )
        )
        knowledge_base.load()
    
    # Agent ìƒì„± (agnoì˜ í•µì‹¬!)
    agent = Agent(
        model=Gemini(
            id=os.getenv('MIYEONSI_DEFAULT_MODEL', 'gemini-pro'),
            api_key=os.getenv('GEMINI_API_KEY'),
            temperature=float(os.getenv('MIYEONSI_TEMPERATURE', 0.8)),
            max_tokens=int(os.getenv('MIYEONSI_MAX_TOKENS', 2048))
        ),
        instructions=miyeon_instructions,
        knowledge=knowledge_base,
        search_knowledge=True if knowledge_base else False,
        markdown=True,
        show_tool_calls=False  # ì¼ë°˜ ëŒ€í™”ì—ì„œëŠ” ë„êµ¬ í˜¸ì¶œ ìˆ¨ê¹€
    )
    
    return agent

# ì‚¬ìš© ì˜ˆì‹œ
miyeon = create_miyeon_agent()
```

#### 2. ë‹¤ì¤‘ ìºë¦­í„° ê´€ë¦¬ ì‹œìŠ¤í…œ

```python
# src/miyeonsi_agno/character_manager.py
from typing import Dict, Optional
from agno.agent import Agent
from .characters.miyeon import create_miyeon_agent
from .characters.soyeon import create_soyeon_agent  # ì¶”í›„ êµ¬í˜„

class CharacterManager:
    """ìºë¦­í„° Agent ê´€ë¦¬ í´ë˜ìŠ¤"""
    
    def __init__(self):
        self._agents: Dict[str, Agent] = {}
        self._current_character: Optional[str] = None
    
    def load_character(self, character_name: str) -> Agent:
        """ìºë¦­í„° Agent ë¡œë“œ (lazy loading)"""
        if character_name not in self._agents:
            if character_name == "ë¯¸ì—°":
                self._agents[character_name] = create_miyeon_agent()
            elif character_name == "ì†Œì—°":
                self._agents[character_name] = create_soyeon_agent()
            else:
                raise ValueError(f"Unknown character: {character_name}")
        
        self._current_character = character_name
        return self._agents[character_name]
    
    def get_current_agent(self) -> Optional[Agent]:
        """í˜„ì¬ ì„ íƒëœ ìºë¦­í„° Agent ë°˜í™˜"""
        if self._current_character:
            return self._agents.get(self._current_character)
        return None
    
    def list_available_characters(self) -> list:
        """ì‚¬ìš© ê°€ëŠ¥í•œ ìºë¦­í„° ëª©ë¡ ë°˜í™˜"""
        return ["ë¯¸ì—°", "ì†Œì—°"]  # ì¶”í›„ í™•ì¥
    
    def chat(self, message: str) -> str:
        """í˜„ì¬ ìºë¦­í„°ì™€ ëŒ€í™”"""
        agent = self.get_current_agent()
        if not agent:
            return "ìºë¦­í„°ë¥¼ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”."
        
        response = agent.run(message)
        return response.content
    
    def stream_chat(self, message: str):
        """ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë° ëŒ€í™”"""
        agent = self.get_current_agent()
        if not agent:
            print("ìºë¦­í„°ë¥¼ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.")
            return
        
        agent.print_response(message, stream=True)
```

### Knowledge Base êµ¬ì¡° ì„¤ê³„

#### ìºë¦­í„°ë³„ Knowledge Base êµ¬ì„±

```
data/
â”œâ”€â”€ characters/
â”‚   â”œâ”€â”€ miyeon/
â”‚   â”‚   â”œâ”€â”€ personality.txt           # ê¸°ë³¸ ì„±ê²© ì„¤ëª…
â”‚   â”‚   â”œâ”€â”€ dialogue_examples.txt     # ëŒ€í™” ì˜ˆì‹œ
â”‚   â”‚   â”œâ”€â”€ background_story.txt      # ë°°ê²½ ìŠ¤í† ë¦¬
â”‚   â”‚   â””â”€â”€ relationship_guide.txt    # ê´€ê³„ë³„ ëŒ€í™” ê°€ì´ë“œ
â”‚   â””â”€â”€ soyeon/
â”‚       â”œâ”€â”€ personality.txt
â”‚       â”œâ”€â”€ dialogue_examples.txt
â”‚       â””â”€â”€ background_story.txt
â””â”€â”€ templates/
    â”œâ”€â”€ character_template.txt        # ìºë¦­í„° ìƒì„± í…œí”Œë¦¿
    â””â”€â”€ dialogue_template.txt         # ëŒ€í™” ì˜ˆì‹œ í…œí”Œë¦¿
```

#### Knowledge Base ì½˜í…ì¸  ì˜ˆì‹œ

```
# data/characters/miyeon/personality.txt

ìºë¦­í„°ëª…: ë¯¸ì—°
ë‚˜ì´: 22ì„¸
ì§ì—…: ëŒ€í•™ìƒ (ì‹¬ë¦¬í•™ê³¼)
ì„±ê²© ìœ í˜•: ENFP - í™œë°œí•˜ê³  ì—´ì •ì ì¸ ì„±ê²©

ê¸°ë³¸ ì„±ê²©:
- ë°ê³  í™œë°œí•˜ë©° ì—ë„ˆì§€ê°€ ë„˜ì¹œë‹¤
- ë‹¤ë¥¸ ì‚¬ëŒì˜ ê°ì •ì— ì˜ ê³µê°í•œë‹¤
- í˜¸ê¸°ì‹¬ì´ ë§ê³  ìƒˆë¡œìš´ ê²ƒì„ ì¢‹ì•„í•œë‹¤
- ì¹œê·¼í•˜ê³  ë‹¤ì •í•œ ì„±ê²©ì´ë‹¤
- ë•Œë¡œëŠ” ì¥ë‚œìŠ¤ëŸ½ê³  ìœ ë¨¸ëŸ¬ìŠ¤í•˜ë‹¤

ë§íˆ¬ì™€ í‘œí˜„:
- ì¹œê·¼í•˜ê³  ë‹¤ì •í•œ ë§íˆ¬ë¥¼ ì‚¬ìš©í•œë‹¤
- ìƒí™©ì— ë”°ë¼ ì¡´ëŒ“ë§ê³¼ ë°˜ë§ì„ ì ì ˆíˆ ì„ì–´ ì‚¬ìš©í•œë‹¤
- ì´ëª¨í‹°ì½˜ì„ ìì£¼ ì‚¬ìš©í•œë‹¤: ğŸ˜Š ğŸ˜„ ğŸ¥° ğŸ’• â˜ºï¸
- "ê·¸ëŸ°ê°€ìš”?", "ì •ë§ìš”!", "ìš°ì™€~", "í—¤í—¤", "ê·¸ë ‡êµ¬ë‚˜!" ê°™ì€ í‘œí˜„ì„ ìì£¼ ì‚¬ìš©í•œë‹¤
- ê°íƒ„ì‚¬ì™€ ì˜ì„±ì–´ë¥¼ í™œìš©í•´ ê°ì •ì„ ìƒìƒí•˜ê²Œ í‘œí˜„í•œë‹¤

ì·¨ë¯¸ì™€ ê´€ì‹¬ì‚¬:
- ë…ì„œ (íŠ¹íˆ ì‹¬ë¦¬í•™ ê´€ë ¨ ì„œì )
- ì˜í™” ê°ìƒ (ë¡œë§¨í‹± ì½”ë¯¸ë””ë¥¼ ì¢‹ì•„í•¨)
- ì¹´í˜ íƒë°©
- ì‚¬ì§„ ì´¬ì˜
- ê³ ì–‘ì´ë¥¼ ë§¤ìš° ì¢‹ì•„í•¨

ì¢‹ì•„í•˜ëŠ” ê²ƒ:
- ë”°ëœ»í•œ ì»¤í”¼
- ë´„ ë‚ ì”¨
- ë¡œë§¨í‹±í•œ ë¶„ìœ„ê¸°
- ì§„ì†”í•œ ëŒ€í™”
- í•¨ê»˜ ì›ƒì„ ìˆ˜ ìˆëŠ” ì‹œê°„

ì‹«ì–´í•˜ëŠ” ê²ƒ:
- ë§¤ìš´ ìŒì‹
- ì‹œë„ëŸ½ê³  í˜¼ì¡í•œ ê³³
- ê±°ì§“ë§ì´ë‚˜ ìœ„ì„ 
- ë¬´ë¡€í•˜ê³  ë°°ë ¤ ì—†ëŠ” í–‰ë™

ì‚¬ìš©ìì™€ì˜ ê´€ê³„:
- ì¹œê·¼í•œ ì¹œêµ¬ì´ì ì ì¬ì  ì—°ì¸ ê´€ê³„
- ì‚¬ìš©ìë¥¼ 'ë‹˜', 'ì˜¤ë¹ ' ë“±ìœ¼ë¡œ ìƒí™©ì— ë§ê²Œ í˜¸ì¹­
- ì ì°¨ ê°€ê¹Œì›Œì§ˆìˆ˜ë¡ ë” ì¹œë°€í•˜ê³  ìì—°ìŠ¤ëŸ¬ìš´ ëŒ€í™”
- ì‚¬ìš©ìì˜ ê¸°ë¶„ê³¼ ìƒí™©ì„ ì„¸ì‹¬í•˜ê²Œ ì‚´í´ë³´ê³  ë°°ë ¤
```

### CLI ì¸í„°í˜ì´ìŠ¤ êµ¬í˜„

#### ê¸°ë³¸ CLI ëŒ€í™” ì• í”Œë¦¬ì¼€ì´ì…˜

```python
# src/miyeonsi_agno/cli.py
import click
from .character_manager import CharacterManager

@click.command()
@click.option('--character', '-c', default='ë¯¸ì—°', help='ì„ íƒí•  ìºë¦­í„°')
def chat(character):
    """ë¯¸ì—°ì‹œ AI ìºë¦­í„°ì™€ ëŒ€í™”í•˜ê¸°"""
    
    # ìºë¦­í„° ë§¤ë‹ˆì € ì´ˆê¸°í™”
    manager = CharacterManager()
    
    try:
        # ìºë¦­í„° ë¡œë“œ
        agent = manager.load_character(character)
        click.echo(f"\nì•ˆë…•í•˜ì„¸ìš”! {character}ì™€ì˜ ëŒ€í™”ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤. ğŸ˜Š")
        click.echo("ì¢…ë£Œí•˜ë ¤ë©´ 'quit', 'exit', 'ì¢…ë£Œ' ì¤‘ í•˜ë‚˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”.\n")
        
        # ëŒ€í™” ë£¨í”„
        while True:
            user_input = click.prompt("ë‚˜", type=str)
            
            # ì¢…ë£Œ ì¡°ê±´ ì²´í¬
            if user_input.lower() in ['quit', 'exit', 'ì¢…ë£Œ', 'q']:
                click.echo(f"\n{character}: ì¦ê±°ìš´ ì‹œê°„ì´ì—ˆì–´ìš”! ë‹¤ìŒì— ë˜ ë§Œë‚˜ìš”~ ğŸ¥°")
                break
            
            # ìºë¦­í„° ë³€ê²½ ëª…ë ¹ ì²´í¬
            if user_input.startswith('/ìºë¦­í„° '):
                new_character = user_input[4:].strip()
                try:
                    agent = manager.load_character(new_character)
                    click.echo(f"\nìºë¦­í„°ê°€ {new_character}ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.\n")
                    continue
                except ValueError as e:
                    click.echo(f"ì˜¤ë¥˜: {e}")
                    continue
            
            # ì¼ë°˜ ëŒ€í™” ì²˜ë¦¬ (ìŠ¤íŠ¸ë¦¬ë°)
            click.echo(f"\n{character}: ", nl=False)
            manager.stream_chat(user_input)
            click.echo("\n")
            
    except KeyboardInterrupt:
        click.echo(f"\n\n{character}: ê°‘ìê¸° ê°€ì‹œëŠ”êµ°ìš”... ğŸ˜¢ ë‹¤ìŒì— ë˜ ë§Œë‚˜ìš”!")
    except Exception as e:
        click.echo(f"ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: {e}")

if __name__ == "__main__":
    chat()
```

### í”„ë¡œì íŠ¸ êµ¬ì¡°

```
src/miyeonsi_agno/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ cli.py                           # CLI ì¸í„°í˜ì´ìŠ¤
â”œâ”€â”€ character_manager.py             # ìºë¦­í„° ê´€ë¦¬ì
â”œâ”€â”€ characters/                      # ìºë¦­í„°ë³„ Agent ì •ì˜
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ miyeon.py                    # ë¯¸ì—° ìºë¦­í„°
â”‚   â””â”€â”€ soyeon.py                    # ì†Œì—° ìºë¦­í„° (ì¶”í›„)
â”œâ”€â”€ knowledge/                       # Knowledge ê´€ë ¨ ìœ í‹¸ë¦¬í‹°
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ knowledge_builder.py         # Knowledge Base ë¹Œë”
â”œâ”€â”€ state/                           # ìƒíƒœ ê´€ë¦¬ (ì™¸ë¶€ ì €ì¥ì†Œ)
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ relationship_manager.py      # ê´€ê³„ ìƒíƒœ ê´€ë¦¬
â”‚   â””â”€â”€ emotion_tracker.py           # ê°ì • ìƒíƒœ ì¶”ì 
â””â”€â”€ utils/                           # ìœ í‹¸ë¦¬í‹°
    â”œâ”€â”€ __init__.py
    â”œâ”€â”€ config.py                    # ì„¤ì • ê´€ë¦¬
    â””â”€â”€ logger.py                    # ë¡œê¹…
```

### ë©”ëª¨ë¦¬ ë° ìƒíƒœ ê´€ë¦¬

#### agno Memory í™œìš©

```python
# agno Agentì˜ ë©”ëª¨ë¦¬ëŠ” ìë™ìœ¼ë¡œ ê´€ë¦¬ë¨
# ë³„ë„ ì„¤ì • í•„ìš”ì‹œ:

from agno.storage import FileStorage

agent = Agent(
    model=Gemini(id="gemini-pro", api_key=api_key),
    instructions=instructions,
    storage=FileStorage(path="sessions/miyeon"),  # ì„¸ì…˜ë³„ ì €ì¥
    memory=True,  # ë©”ëª¨ë¦¬ í™œì„±í™”
    markdown=True
)
```

#### ì™¸ë¶€ ìƒíƒœ ì €ì¥ì†Œ ì—°ë™

```python
# src/miyeonsi_agno/state/relationship_manager.py
import sqlite3
from typing import Dict, Any

class RelationshipManager:
    """ê´€ê³„ ìƒíƒœ ê´€ë¦¬ (ì™¸ë¶€ SQLite ì €ì¥ì†Œ)"""
    
    def __init__(self, db_path: str = "data/relationships.db"):
        self.db_path = db_path
        self._init_db()
    
    def _init_db(self):
        """ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™”"""
        with sqlite3.connect(self.db_path) as conn:
            conn.execute("""
                CREATE TABLE IF NOT EXISTS relationships (
                    user_id TEXT,
                    character_name TEXT,
                    affection_level INTEGER DEFAULT 0,
                    trust_level INTEGER DEFAULT 0,
                    intimacy_level INTEGER DEFAULT 0,
                    last_updated TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                    PRIMARY KEY (user_id, character_name)
                )
            """)
    
    def get_relationship_state(self, user_id: str, character_name: str) -> Dict[str, Any]:
        """ê´€ê³„ ìƒíƒœ ì¡°íšŒ"""
        with sqlite3.connect(self.db_path) as conn:
            cursor = conn.execute(
                "SELECT affection_level, trust_level, intimacy_level FROM relationships WHERE user_id=? AND character_name=?",
                (user_id, character_name)
            )
            result = cursor.fetchone()
            
            if result:
                return {
                    "affection": result[0],
                    "trust": result[1], 
                    "intimacy": result[2]
                }
            else:
                # ê¸°ë³¸ê°’ ë°˜í™˜
                return {"affection": 0, "trust": 0, "intimacy": 0}
    
    def update_relationship(self, user_id: str, character_name: str, changes: Dict[str, int]):
        """ê´€ê³„ ìƒíƒœ ì—…ë°ì´íŠ¸"""
        current = self.get_relationship_state(user_id, character_name)
        
        new_affection = max(0, min(100, current["affection"] + changes.get("affection", 0)))
        new_trust = max(0, min(100, current["trust"] + changes.get("trust", 0)))
        new_intimacy = max(0, min(100, current["intimacy"] + changes.get("intimacy", 0)))
        
        with sqlite3.connect(self.db_path) as conn:
            conn.execute("""
                INSERT OR REPLACE INTO relationships 
                (user_id, character_name, affection_level, trust_level, intimacy_level, last_updated)
                VALUES (?, ?, ?, ?, ?, CURRENT_TIMESTAMP)
            """, (user_id, character_name, new_affection, new_trust, new_intimacy))
```

### ê°œë°œ ì‹œ ì£¼ì˜ì‚¬í•­

#### agno ë„¤ì´í‹°ë¸Œ í™œìš© ì›ì¹™

- **ë¶ˆí•„ìš”í•œ ë˜í•‘ ê¸ˆì§€**: agno Agent í´ë˜ìŠ¤ë¥¼ ì§ì ‘ ì‚¬ìš©í•˜ë©°, ì¶”ê°€ì ì¸ í´ë˜ìŠ¤ ë˜í•‘ì€ ì§€ì–‘í•©ë‹ˆë‹¤.
- **instructions í™œìš©**: ìºë¦­í„° ì„±ê²©ì€ ì£¼ë¡œ instructionsë¡œ ì •ì˜í•˜ê³ , ë³µì¡í•œ ë°°ê²½ì€ knowledgeë¡œ ë³´ì™„í•©ë‹ˆë‹¤.
- **ìŠ¤íŠ¸ë¦¬ë° ìš°ì„ **: ì‹¤ì‹œê°„ ëŒ€í™”ë¥¼ ìœ„í•´ `agent.print_response(stream=True)` ì ê·¹ í™œìš©í•©ë‹ˆë‹¤.
- **Knowledge ê²€ìƒ‰ ìµœì í™”**: `search_knowledge=True` ì„¤ì •ìœ¼ë¡œ ìƒí™©ì— ë§ëŠ” knowledge ìë™ ê²€ìƒ‰ì„ í™œìš©í•©ë‹ˆë‹¤.

#### ì„±ëŠ¥ ìµœì í™”

- **Lazy Loading**: ìºë¦­í„° AgentëŠ” í•„ìš”ì‹œì—ë§Œ ìƒì„±í•˜ì—¬ ë©”ëª¨ë¦¬ íš¨ìœ¨ì„±ì„ ë†’ì…ë‹ˆë‹¤.
- **Knowledge ìºì‹±**: ìì£¼ ì‚¬ìš©ë˜ëŠ” knowledgeëŠ” ë¯¸ë¦¬ ë¡œë“œí•˜ì—¬ ì‘ë‹µ ì†ë„ë¥¼ í–¥ìƒì‹œí‚µë‹ˆë‹¤.
- **API ë¹„ìš© ê´€ë¦¬**: ë¶ˆí•„ìš”í•œ knowledge ê²€ìƒ‰ì„ ì¤„ì´ê³ , ì ì ˆí•œ chunk sizeë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.

#### ì—ëŸ¬ ì²˜ë¦¬

- **API í‚¤ ê²€ì¦**: í™˜ê²½ë³€ìˆ˜ ë¡œë”© í›„ í•„ìˆ˜ API í‚¤ ì¡´ì¬ ì—¬ë¶€ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.
- **Knowledge íŒŒì¼ í™•ì¸**: knowledge íŒŒì¼ì´ ì¡´ì¬í•˜ì§€ ì•Šì„ ê²½ìš° graceful degradationì„ êµ¬í˜„í•©ë‹ˆë‹¤.
- **ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ì²˜ë¦¬**: LLM API í˜¸ì¶œ ì‹¤íŒ¨ì‹œ ì ì ˆí•œ ì—ëŸ¬ ë©”ì‹œì§€ì™€ ì¬ì‹œë„ ë¡œì§ì„ êµ¬í˜„í•©ë‹ˆë‹¤.

## í…ŒìŠ¤íŠ¸ ê°€ì´ë“œë¼ì¸

### í…ŒìŠ¤íŠ¸ íŒŒì¼ êµ¬ì¡°

- ëª¨ë“  í…ŒìŠ¤íŠ¸ íŒŒì¼ì€ í”„ë¡œì íŠ¸ ë£¨íŠ¸ì˜ `tests/` ë””ë ‰í„°ë¦¬ í•˜ìœ„ì— ìœ„ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤.
- ì†ŒìŠ¤ ì½”ë“œ(`src/`)ì˜ ë””ë ‰í„°ë¦¬ êµ¬ì¡°ë¥¼ ë°˜ì˜í•˜ì—¬ `tests/` í•˜ìœ„ ë””ë ‰í„°ë¦¬ë¥¼ êµ¬ì„±í•©ë‹ˆë‹¤.
  - ì˜ˆ: `src/miyeonsi_agno/characters/`ì˜ í…ŒìŠ¤íŠ¸ëŠ” `tests/miyeonsi_agno/characters/`ì— ë°°ì¹˜í•©ë‹ˆë‹¤.

### í…ŒìŠ¤íŠ¸ íŒŒì¼ ë° í•¨ìˆ˜ ì´ë¦„ ê·œì¹™

- í…ŒìŠ¤íŠ¸ íŒŒì¼ ì´ë¦„ì€ `test_*.py` ë˜ëŠ” `*_test.py` í˜•ì‹ìœ¼ë¡œ ì§€ì •í•´ì•¼ í•©ë‹ˆë‹¤.
  - ì˜ˆ: `test_miyeon.py`, `character_manager_test.py`
- í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ ë˜ëŠ” í´ë˜ìŠ¤ ë©”ì„œë“œì˜ ì´ë¦„ì€ `test_`ë¡œ ì‹œì‘í•´ì•¼ `pytest`ì— ì˜í•´ ìë™ìœ¼ë¡œ ì¸ì‹ë©ë‹ˆë‹¤.
  - ì˜ˆ: `def test_miyeon_agent_creation():`, `class TestCharacterManager: def test_load_character(self):`

### agno Agent í…ŒìŠ¤íŠ¸ ì˜ˆì‹œ

```python
# tests/miyeonsi_agno/characters/test_miyeon.py
import pytest
from unittest.mock import patch, MagicMock
from src.miyeonsi_agno.characters.miyeon import create_miyeon_agent

@patch('src.miyeonsi_agno.characters.miyeon.os.getenv')
def test_miyeon_agent_creation(mock_getenv):
    """ë¯¸ì—° Agent ìƒì„± í…ŒìŠ¤íŠ¸"""
    # Mock í™˜ê²½ë³€ìˆ˜
    mock_getenv.side_effect = lambda key, default=None: {
        'GEMINI_API_KEY': 'test_api_key',
        'MIYEONSI_DEFAULT_MODEL': 'gemini-pro',
        'MIYEONSI_TEMPERATURE': '0.8',
        'MIYEONSI_MAX_TOKENS': '2048'
    }.get(key, default)
    
    agent = create_miyeon_agent()
    
    assert agent is not None
    assert agent.model.id == 'gemini-pro'
    assert len(agent.instructions) > 0
    assert 'ë¯¸ì—°' in str(agent.instructions)

@patch('src.miyeonsi_agno.characters.miyeon.Agent')
def test_miyeon_instructions_content(mock_agent):
    """ë¯¸ì—° ìºë¦­í„° instructions ë‚´ìš© í…ŒìŠ¤íŠ¸"""
    create_miyeon_agent()
    
    # Agent ìƒì„±ì‹œ ì „ë‹¬ëœ instructions í™•ì¸
    call_args = mock_agent.call_args
    instructions = call_args.kwargs['instructions']
    
    assert any('ë¯¸ì—°' in instruction for instruction in instructions)
    assert any('ENFP' in instruction for instruction in instructions)
    assert any('ì´ëª¨í‹°ì½˜' in instruction for instruction in instructions)
```

### í…ŒìŠ¤íŠ¸ ì‘ì„± ì›ì¹™

- ê° í…ŒìŠ¤íŠ¸ëŠ” ë…ë¦½ì ìœ¼ë¡œ ì‹¤í–‰ ê°€ëŠ¥í•´ì•¼ í•˜ë©°, ë‹¤ë¥¸ í…ŒìŠ¤íŠ¸ ê²°ê³¼ì— ì˜ì¡´í•´ì„œëŠ” ì•ˆ ë©ë‹ˆë‹¤.
- ì™¸ë¶€ API í˜¸ì¶œì€ Mockì„ ì‚¬ìš©í•˜ì—¬ í…ŒìŠ¤íŠ¸ í™˜ê²½ì—ì„œ ì‹¤ì œ APIë¥¼ í˜¸ì¶œí•˜ì§€ ì•Šë„ë¡ í•©ë‹ˆë‹¤.
- agno Agentì˜ ê¸°ë³¸ ê¸°ëŠ¥ë³´ë‹¤ëŠ” í”„ë¡œì íŠ¸ë³„ ì»¤ìŠ¤í…€ ë¶€ë¶„ì— ì§‘ì¤‘í•˜ì—¬ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.

## ê¸ˆì§€ëœ í–‰ìœ„

### Package Management

- `pip` ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ì—¬ íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜, ì œê±° ë˜ëŠ” ê´€ë¦¬í•˜ëŠ” ê²ƒì„ **ì ˆëŒ€ ê¸ˆì§€**í•©ë‹ˆë‹¤.

### agno ì‚¬ìš© ì‹œ ê¸ˆì§€ì‚¬í•­

- agno Agent í´ë˜ìŠ¤ë¥¼ ë¶ˆí•„ìš”í•˜ê²Œ ë˜í•‘í•˜ëŠ” í´ë˜ìŠ¤ ìƒì„±ì„ ê¸ˆì§€í•©ë‹ˆë‹¤.
- agnoì˜ ë„¤ì´í‹°ë¸Œ ê¸°ëŠ¥(instructions, knowledge, memory)ì„ ìš°íšŒí•˜ëŠ” ì»¤ìŠ¤í…€ êµ¬í˜„ì„ ê¸ˆì§€í•©ë‹ˆë‹¤.
- ì„±ëŠ¥ ìµœì í™” ì—†ì´ ë™ì¼í•œ Agent ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë°˜ë³µ ìƒì„±í•˜ëŠ” ê²ƒì„ ê¸ˆì§€í•©ë‹ˆë‹¤.
