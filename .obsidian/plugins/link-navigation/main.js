/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var D=Object.defineProperty;var S=Object.getOwnPropertyDescriptor;var A=Object.getOwnPropertyNames;var F=Object.prototype.hasOwnProperty;var N=(f,v)=>{for(var t in v)D(f,t,{get:v[t],enumerable:!0})},V=(f,v,t,e)=>{if(v&&typeof v=="object"||typeof v=="function")for(let i of A(v))!F.call(f,i)&&i!==t&&D(f,i,{get:()=>v[i],enumerable:!(e=S(v,i))||e.enumerable});return f};var O=f=>V(D({},"__esModule",{value:!0}),f);var M={};N(M,{default:()=>b});module.exports=O(M);var a=require("obsidian"),T={isCanvasLinksEnabled:!0,isAttachmentsEnabled:!0,isTagsEnabled:!0,toggleCanvasLinks:void 0,toggleAttachments:void 0,toggleTags:void 0,cacheTimeout:5*60*1e3,cacheCleanupInterval:5,showCacheCleanupNotice:!0,inlinkFormat:"{arrow} {label} ({count})",outlinkFormat:"{label} ({count}) {arrow}",showInlinkCount:!0,showOutlinkCount:!0,inlinkText:"INLINKS",outlinkText:"OUTLINKS",inlinkArrow:"\u2190",outlinkArrow:"\u2192",inlinkCustomClass:"",outlinkCustomClass:"",inlinkIcon:"arrow-left-circle",outlinkIcon:"arrow-right-circle"},y=class extends a.Modal{constructor(t,e,i,n){super(t);this.plugin=e,this.settingKey=i,this.iconInput=n}onOpen(){let{contentEl:t}=this;t.empty(),t.createEl("h2",{text:"Select a Lucide Icon"}),this.searchInput=new a.TextComponent(t).setPlaceholder("Search for icons..."),this.searchInput.inputEl.style.width="100%",this.searchInput.onChange((0,a.debounce)(()=>{this.updateIconList(this.searchInput.getValue())},50,!1)),this.iconList=t.createEl("div",{cls:"icon-picker-list"}),this.iconList.style.overflowY="scroll",this.iconList.style.maxHeight="300px",this.iconList.style.border="1px solid var(--background-modifier-border)",this.updateIconList("")}updateIconList(t){requestAnimationFrame(()=>{this.iconList.empty();let e=t.toLowerCase(),n=(0,a.getIconIds)().filter(s=>s.toLowerCase().includes(e));n.length===0&&t!==""?this.iconList.createEl("div",{text:"No icons found.",cls:"icon-picker-item"}):n.forEach(s=>{let l=this.iconList.createEl("div",{cls:"icon-picker-item"});l.style.display="flex",l.style.alignItems="center",l.style.padding="5px",l.style.cursor="pointer";let c=l.createEl("span",{cls:"icon-picker-icon"});c.style.marginRight="10px",(0,a.setIcon)(c,s),l.createEl("span",{text:s}),this.plugin.registerDomEvent(l,"click",()=>{this.plugin.settings[this.settingKey]=s,this.plugin.saveSettings(),this.iconInput.setValue(s),this.close()})})})}onClose(){let{contentEl:t}=this;t.empty()}},b=class extends a.Plugin{constructor(){super(...arguments);this.maxDepth=1;this.inlinksEl=null;this.outlinksEl=null;this.detailsEl=null;this.isDetailsVisible=!1;this.toggleCanvasLinks=!0;this.outlinksOfInlinksVisible=!1;this.shouldShowDetailedView=!1;this.toggleAttachments=!0;this.toggleTags=!1;this.cache=new Map;this.loadingPromises=new Map;this.maxCacheSize=200;this.dirtyCache=new Set;this.cacheCleanupInterval=null;this.lastCleanupNotice=0;this.CLEANUP_NOTICE_COOLDOWN=5e3;this.inlinkIconTextComponent=null;this.outlinkIconTextComponent=null;this.toggleDetailedViewHandler=t=>{t.stopPropagation();let e=this.app.workspace.getActiveViewOfType(a.MarkdownView),i=this.app.workspace.getActiveFile();e&&i&&this.toggleDetailedView(e,i)};this.handleEscapeKey=t=>{if(t.key==="Escape"&&this.shouldShowDetailedView){let e=this.app.workspace.getActiveViewOfType(a.MarkdownView),i=this.app.workspace.getActiveFile();e&&i&&this.toggleDetailedView(e,i)}};this.handleClickOutside=t=>{var e,i;if(this.detailsEl&&this.shouldShowDetailedView){let n=t.target,s=this.detailsEl.querySelector(".link-navigator-details");if(s instanceof HTMLElement&&!s.contains(n)&&!((e=this.inlinksEl)!=null&&e.contains(n))&&!((i=this.outlinksEl)!=null&&i.contains(n))){let l=this.app.workspace.getActiveViewOfType(a.MarkdownView),c=this.app.workspace.getActiveFile();l&&c&&this.toggleDetailedView(l,c)}}};this.debouncedUpdateLinkNavigation=(0,a.debounce)(async(t,e)=>this.updateLinkNavigation(t),800,!0)}async onload(){var t,e,i;await this.loadSettings(),this.addSettingTab(new x(this.app,this)),this.toggleCanvasLinks=(t=this.settings.toggleCanvasLinks)!=null?t:this.settings.isCanvasLinksEnabled,this.toggleAttachments=(e=this.settings.toggleAttachments)!=null?e:this.settings.isAttachmentsEnabled,this.toggleTags=(i=this.settings.toggleTags)!=null?i:this.settings.isTagsEnabled,this.registerEvent(this.app.workspace.on("file-open",n=>{n instanceof a.TFile&&this.updateLinkNavigation(n)})),this.addCommand({id:"force-refresh-link-navigation",name:"Force refresh link navigation",callback:()=>{let n=this.app.workspace.getActiveFile();n&&this.updateLinkNavigation(n,!0)}}),this.addCommand({id:"toggle-link-navigation-detailed-view",name:"Toggle link navigation detailed view",callback:()=>{let n=this.app.workspace.getActiveFile(),s=this.app.workspace.getActiveViewOfType(a.MarkdownView);n&&s&&this.toggleDetailedView(s,n)}}),document.addEventListener("keydown",this.handleEscapeKey),this.setupCacheCleanup()}onunload(){this.removeLinkNavigation(),document.removeEventListener("click",this.handleClickOutside),this.cache.clear(),this.loadingPromises.clear(),this.dirtyCache.clear(),this.shouldShowDetailedView=!1,document.removeEventListener("keydown",this.handleEscapeKey),this.cacheCleanupInterval!==null&&(clearInterval(this.cacheCleanupInterval),this.cacheCleanupInterval=null)}async loadSettings(){var e,i,n;let t=await this.loadData();this.settings=Object.assign({},T,t),this.settings.toggleCanvasLinks=(e=t==null?void 0:t.toggleCanvasLinks)!=null?e:T.isCanvasLinksEnabled,this.settings.toggleAttachments=(i=t==null?void 0:t.toggleAttachments)!=null?i:T.isAttachmentsEnabled,this.settings.toggleTags=(n=t==null?void 0:t.toggleTags)!=null?n:T.isTagsEnabled}async saveSettings(){await this.saveData(this.settings)}async updateSettings(t){Object.assign(this.settings,t),await this.saveSettings()}formatLinkText(t,e,i,n,s,l){let c=t.replace("{label}",e);if(c=c.replace("{arrow}",n),t.includes("{icon}"))if((0,a.getIcon)(l)){let o=`<span class="link-navigator-icon">${(0,a.getIcon)(l).outerHTML}</span>`;c=c.replace("{icon}",o)}else console.warn(`Link Navigator: Invalid icon ID: ${l}`),c=c.replace("{icon}",'<span class="link-navigator-icon">\uFFFD</span>');else c=c.replace("{icon}","");return c=s?c.replace("{count}",i.toString()):c.replace(/(\(|\)|\[|\]|\{|\})?\s*\{count\}\s*(\(|\)|\[|\]|\{|\})?/,""),c}async updateLinkNavigation(t,e=!1){e&&this.invalidateCache(t);let i=this.app.workspace.getActiveViewOfType(a.MarkdownView);if(!i||!(i instanceof a.MarkdownView))return;let n=i.containerEl.querySelector(".view-header"),s=i.containerEl.querySelector(".view-content");if(!n||!s)return;let l=n.querySelector(".view-header-title");if(!l)return;this.removeLinkNavigation(),this.inlinksEl=document.createElement("div"),this.outlinksEl=document.createElement("div"),this.inlinksEl.classList.add("link-navigator-inlinks","link-navigator-visible"),this.outlinksEl.classList.add("link-navigator-outlinks","link-navigator-visible"),this.settings.inlinkCustomClass&&this.inlinksEl.classList.add(...this.settings.inlinkCustomClass.split(" ").filter(Boolean)),this.settings.outlinkCustomClass&&this.outlinksEl.classList.add(...this.settings.outlinkCustomClass.split(" ").filter(Boolean));let c=document.createElement("div");c.classList.add("mobile-link-navigator");let o=this.inlinksEl.cloneNode(!0),r=this.outlinksEl.cloneNode(!0);c.appendChild(o),c.appendChild(r),l.before(this.inlinksEl),l.after(this.outlinksEl),s.prepend(c);try{let{inlinks:h,outlinks:u,canvasLinks:k}=await this.cacheLinkData(t);requestAnimationFrame(()=>{if(this.inlinksEl&&this.outlinksEl){let d=u.length+k.length,g=p=>{p.classList.contains("link-navigator-inlinks")?p.innerHTML=this.formatLinkText(this.settings.inlinkFormat,this.settings.inlinkText,h.length,this.settings.inlinkArrow,this.settings.showInlinkCount,this.settings.inlinkIcon):p.classList.contains("link-navigator-outlinks")&&(p.innerHTML=this.formatLinkText(this.settings.outlinkFormat,this.settings.outlinkText,d,this.settings.outlinkArrow,this.settings.showOutlinkCount,this.settings.outlinkIcon))};g(this.inlinksEl),g(this.outlinksEl),g(o),g(r),this.setupHoverPreview(this.inlinksEl,h,"Inlinks"),this.setupHoverPreview(this.outlinksEl,[...u,...k],"Outlinks"),this.setupHoverPreview(o,h,"Inlinks"),this.setupHoverPreview(r,[...u,...k],"Outlinks"),this.shouldShowDetailedView&&this.toggleDetailedView(i,t),this.updateDetailedViewState(i,t),this.adjustLayout_insideExpandedDetailedView(n,l)}this.adjustLayout_insideExpandedDetailedView(n,l)}),document.addEventListener("click",this.handleClickOutside)}catch(h){console.error("Error updating link navigator:",h)}}removeLinkNavigation(){this.inlinksEl&&this.inlinksEl.remove(),this.outlinksEl&&this.outlinksEl.remove(),this.detailsEl&&this.detailsEl.remove();let t=document.querySelector(".mobile-link-navigator");t&&t.remove(),this.inlinksEl=null,this.outlinksEl=null,this.detailsEl=null}async cacheLinkData(t){var n,s;let e=t.path;if(this.cache.has(e)&&!this.dirtyCache.has(e)){let l=this.cache.get(e);if(l&&Date.now()-l.timestamp<this.settings.cacheTimeout)return l}if(this.loadingPromises.has(e))return(n=this.loadingPromises.get(e))!=null?n:this.getLinks(t);let i=this.getLinks(t);this.loadingPromises.set(e,i);try{let l=await Promise.race([i,new Promise((c,o)=>setTimeout(()=>o(new Error("Loading timeout")),1e4))]);if(this.cache.set(e,{...l,timestamp:Date.now()}),this.loadingPromises.delete(e),this.cache.size>this.maxCacheSize){let c=(s=Array.from(this.cache.entries()).sort(([,o],[,r])=>o.timestamp-r.timestamp)[0])==null?void 0:s[0];c&&this.cache.delete(c)}return l}catch(l){throw this.loadingPromises.delete(e),l}}async getLinks(t){let e=new Set,i=new Set,n=new Set,s=new Set,l=new Set,c=this.app.metadataCache.resolvedLinks;for(let[d,g]of Object.entries(c))if(g[t.path]){let p=this.app.vault.getAbstractFileByPath(d);p instanceof a.TFile&&e.add(p.basename)}let o=this.app.metadataCache.getFileCache(t);if(o){if(o.links)for(let d of o.links)this.addLinkToAppropriateSet(d.link,i,n);if(o.embeds)for(let d of o.embeds)this.addLinkToAppropriateSet(d.link,i,n);if(o.frontmatter){let g=JSON.stringify(o.frontmatter).match(/(?:\[\[([^\]]+)\]\])|(?:!\[\[([^\]]+)\]\])/g)||[];for(let p of g){let w=p.replace(/^!?\[\[|\]\]$/g,"").split("|")[0];this.addLinkToAppropriateSet(w,i,n)}}}if(this.settings.isCanvasLinksEnabled){let d=this.app.vault.getFiles().filter(g=>g.extension==="canvas");for(let g of d){let p=await this.app.vault.read(g),w=t.basename.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");new RegExp(`(?:\\[\\[${w}(?:#[^\\]]+)?(?:\\|.*?)?\\]\\])|(?:!\\[\\[${w}(?:#[^\\]]+)?(?:\\|.*?)?\\]\\])`,"g").test(p)&&n.add(g.basename)}}let r=["avif","bmp","gif","jpeg","jpg","png","svg","webp","tif","tiff","psd","dng","heif","heic","cr2","nef","ico","flac","m4a","mp3","ogg","wav","webm","3gp","mkv","mov","mp4","ogv","avi","pdf","doc","docx","xlsx","pptx","djvu","epub","zip","7z","tar","gz","rar","xc","bzip2","iso","cmg","msi","py","js","ts","html","css","json","xml","java","cpp","cs","rb","php","swift","go","rs","sh"].join("|"),h=new RegExp(`!?\\[\\[([^\\]]+\\.(?:${r}))\\]\\]`,"gi");if(o&&o.embeds)for(let d of o.embeds){let g=this.app.metadataCache.getFirstLinkpathDest(d.link,t.path);if(g instanceof a.TFile){let p=g.extension.toLowerCase();p!=="md"&&p!=="canvas"&&s.add(g.basename+"."+g.extension)}}let u=await this.app.vault.read(t),k;for(;(k=h.exec(u))!==null;)s.add(k[1]);return o&&(o.tags&&o.tags.forEach(d=>l.add(d.tag)),o.frontmatter&&o.frontmatter.tags&&(Array.isArray(o.frontmatter.tags)?o.frontmatter.tags.forEach(d=>l.add(d)):typeof o.frontmatter.tags=="string"&&l.add(o.frontmatter.tags))),{inlinks:Array.from(e),outlinks:Array.from(i),canvasLinks:Array.from(n),attachments:Array.from(s),tags:Array.from(l),timestamp:Date.now()}}addLinkToAppropriateSet(t,e,i){let n=t.split("#")[0],s=this.app.metadataCache.getFirstLinkpathDest(n,"");s instanceof a.TFile&&(s.extension==="canvas"?i.add(s.basename):e.add(s.basename))}renderAttachments(t,e){if(!this.toggleAttachments||e.length===0)return;let i=t.createEl("ul",{cls:"attachments-list"});e.forEach(n=>{var h;let s=i.createEl("li",{cls:"attachment"}),l=(h=n.split(".").pop())==null?void 0:h.toLowerCase(),c="\u{1F4CE}",o={avif:"\u{1F5BC}\uFE0F",bmp:"\u{1F5BC}\uFE0F",gif:"\u{1F5BC}\uFE0F",jpeg:"\u{1F5BC}\uFE0F",jpg:"\u{1F5BC}\uFE0F",png:"\u{1F5BC}\uFE0F",svg:"\u{1F5BC}\uFE0F",webp:"\u{1F5BC}\uFE0F",tif:"\u{1F5BC}\uFE0F",tiff:"\u{1F5BC}\uFE0F",psd:"\u{1F5BC}\uFE0F",dng:"\u{1F5BC}\uFE0F",heif:"\u{1F5BC}\uFE0F",heic:"\u{1F5BC}\uFE0F",cr2:"\u{1F5BC}\uFE0F",nef:"\u{1F5BC}\uFE0F",ico:"\u{1F5BC}\uFE0F",flac:"\u{1F3B5}",m4a:"\u{1F3B5}",mp3:"\u{1F3B5}",ogg:"\u{1F3B5}",wav:"\u{1F3B5}","3gp":"\u{1F3B5}",mkv:"\u{1F3A5}",mov:"\u{1F3A5}",mp4:"\u{1F3A5}",ogv:"\u{1F3A5}",webm:"\u{1F3A5}",avi:"\u{1F3A5}",pdf:"\u{1F4C4}",doc:"\u{1F4C4}",docx:"\u{1F4C4}",xlsx:"\u{1F4CA}",pptx:"\u{1F4CA}",djvu:"\u{1F4DA}",epub:"\u{1F4DA}",zip:"\u{1F5DC}\uFE0F","7z":"\u{1F5DC}\uFE0F",tar:"\u{1F5DC}\uFE0F",gz:"\u{1F5DC}\uFE0F",rar:"\u{1F5DC}\uFE0F",xc:"\u{1F5DC}\uFE0F",bzip2:"\u{1F5DC}\uFE0F",iso:"\u{1F4BF}",cmg:"\u{1F4BF}",msi:"\u{1F4BF}",py:"\u{1F4BB}",js:"\u{1F4BB}",ts:"\u{1F4BB}",html:"\u{1F4BB}",css:"\u{1F4BB}",json:"\u{1F4BB}",xml:"\u{1F4BB}",java:"\u{1F4BB}",cpp:"\u{1F4BB}",cs:"\u{1F4BB}",rb:"\u{1F4BB}",php:"\u{1F4BB}",swift:"\u{1F4BB}",go:"\u{1F4BB}",rs:"\u{1F4BB}",sh:"\u{1F4BB}"};l&&l in o&&(c=o[l]),s.createEl("span",{text:`${c} `,cls:"attachment-icon"}),s.createEl("a",{text:n,cls:"internal-link"}).addEventListener("click",u=>{u.preventDefault();let k=this.app.metadataCache.getFirstLinkpathDest(n,"/");k instanceof a.TFile&&this.app.workspace.getLeaf().openFile(k)})})}renderTags(t,e){if(!this.toggleTags||e.length===0)return;let i=t.createEl("div",{cls:"link-navigator-tags"});e.forEach(n=>{i.createEl("div",{cls:"tag",text:`${n}`}).addEventListener("click",l=>{l.preventDefault(),this.app.workspace.openLinkText(`#${n}`,"",!0)})})}setupHoverPreview(t,e,i){if(e.length===0)return;let n,s=null;t.addEventListener("mouseenter",l=>{this.isDetailsVisible||(n=setTimeout(()=>{s=new a.Menu,s.addItem(c=>c.setTitle(i).setDisabled(!0)),e.forEach(c=>{s==null||s.addItem(o=>o.setTitle(c).onClick(()=>{this.app.metadataCache.getFirstLinkpathDest(c,"/")&&this.app.workspace.openLinkText(c,"/",!1)}))}),s.showAtMouseEvent(l)},900))}),t.addEventListener("mouseleave",()=>{clearTimeout(n),s&&s.hide()})}toggleDetailedView(t,e){var i,n;this.shouldShowDetailedView||(n=(i=this.detailsEl)==null?void 0:i.querySelector(".link-navigator-details"))!=null&&n.classList.contains("visible")?this.shouldShowDetailedView=!1:this.shouldShowDetailedView=!0,this.updateDetailedViewState(t,e)}updateDetailedViewState(t,e){var n;this.detailsEl||(this.detailsEl=t.containerEl.createEl("div",{cls:"link-navigator-details-wrapper"}),this.detailsEl.createEl("div",{cls:"link-navigator-details"}).classList.add("hidden"),(n=t.containerEl.querySelector(".view-content"))==null||n.prepend(this.detailsEl));let i=this.detailsEl.querySelector(".link-navigator-details");this.shouldShowDetailedView?(i.classList.remove("hidden"),i.classList.add("visible"),this.renderDetailedView(i,e)):(i.classList.remove("visible"),i.classList.add("hidden")),this.updateClickHandlers(t)}updateClickHandlers(t){let e=n=>{n&&n.style.display!=="none"&&(n.removeEventListener("click",this.toggleDetailedViewHandler),n.addEventListener("click",this.toggleDetailedViewHandler))};e(this.inlinksEl),e(this.outlinksEl);let i=t.containerEl.querySelector(".mobile-link-navigator");if(i){let n=i.querySelector(".link-navigator-inlinks"),s=i.querySelector(".link-navigator-outlinks");n instanceof HTMLElement&&e(n),s instanceof HTMLElement&&e(s)}}async renderDetailedView(t,e){t.empty();let n=t.createDiv("link-navigator-controls").createDiv("depth-and-buttons-wrapper"),s=n.createDiv("depth-control");s.createSpan({text:"Depth: "}),this.depthInput=new a.TextComponent(s).setValue(this.maxDepth.toString()).setPlaceholder("Enter depth").onChange(async o=>{let r=parseInt(o);!isNaN(r)&&r>0&&(this.maxDepth=r,await this.updateDetailedViewContent(t,e))});let l=n.createDiv("button-container");if(new a.ButtonComponent(l).setIcon("refresh-cw").setTooltip("Refresh links").onClick(()=>{this.cache.delete(e.path),this.updateLinkNavigation(e)}),this.settings.isCanvasLinksEnabled){let o=new a.ButtonComponent(l).setButtonText("Canvas links").setClass("canvas-links-toggle").onClick(async()=>{this.toggleCanvasLinks=!this.toggleCanvasLinks,o.buttonEl.classList.toggle("active",this.toggleCanvasLinks),await this.updateSettings({toggleCanvasLinks:this.toggleCanvasLinks}),this.updateDetailedViewContent(t,e)});o.buttonEl.classList.toggle("active",this.toggleCanvasLinks)}t.createDiv("link-navigator-content");let c=new a.ButtonComponent(l).setIcon("git-branch").setTooltip("Toggle outlinks of inlinks").onClick(()=>{this.outlinksOfInlinksVisible=!this.outlinksOfInlinksVisible,c.buttonEl.classList.toggle("active"),document.querySelectorAll(".inlink-outlinks").forEach(r=>r.classList.toggle("hidden",!this.outlinksOfInlinksVisible)),this.updateDetailedViewContent(t,e)});if(this.outlinksOfInlinksVisible&&c.buttonEl.classList.add("active"),this.settings.isAttachmentsEnabled){let o=new a.ButtonComponent(l).setIcon("paperclip").setTooltip("Toggle attachments").onClick(async()=>{this.toggleAttachments=!this.toggleAttachments,o.buttonEl.classList.toggle("active",this.toggleAttachments),await this.updateSettings({toggleAttachments:this.toggleAttachments}),this.updateDetailedViewContent(t,e)});o.buttonEl.classList.toggle("active",this.toggleAttachments)}if(this.settings.isTagsEnabled){let o=new a.ButtonComponent(l).setIcon("tag").setTooltip("Toggle tags").onClick(async()=>{this.toggleTags=!this.toggleTags,o.buttonEl.classList.toggle("active",this.toggleTags),await this.updateSettings({toggleTags:this.toggleTags}),this.updateDetailedViewContent(t,e)});o.buttonEl.classList.toggle("active",this.toggleTags)}await this.updateDetailedViewContent(t,e)}async updateDetailedViewContent(t,e){let i=t.querySelector(".link-navigator-content");if(!i||!(i instanceof HTMLElement))return;i.empty();let n=i.createDiv("link-hierarchy");await this.renderLinkHierarchy(n,e)}async renderLinkHierarchy(t,e){t.empty();let i=t.createEl("ul"),n=await this.cacheLinkData(e),s=await this.renderInlinksIterativelyWithOutlinks(e,i,this.maxDepth),l=s,c=i.createEl("li",{cls:`current-note indent-${l}`});if(c.createEl("span",{text:"\xA0\xA0\xA0 \u2022\xA0\xA0"}),c.createEl("strong",{text:e.basename}),this.toggleTags&&n.tags.length>0){let h=await this.cacheLinkData(e);this.renderTags(c,h.tags)}let o=c.createEl("ul",{cls:"outlinks-list"}),r=Math.max(1,this.maxDepth-s);await this.renderOutlinksIteratively(e,o,r),this.toggleCanvasLinks&&n.canvasLinks.length>0&&this.renderCanvasLinks(i,n.canvasLinks)}async renderInlinksIterativelyWithOutlinks(t,e,i){let n=[{file:t,depth:0}],s=new Map,l=new Set,c=0;for(;n.length>0;){let h=n.shift();if(!h)continue;let{file:u,depth:k}=h;if(k>=i||l.has(u.path))continue;l.add(u.path);let d=await this.cacheLinkData(u);for(let g of d.inlinks){let p=this.app.metadataCache.getFirstLinkpathDest(g,"/");if(p instanceof a.TFile&&!l.has(p.path)){let w=await this.cacheLinkData(p);s.set(p.path,{depth:k+1,file:p,outlinks:w.outlinks}),n.push({file:p,depth:k+1}),c=Math.max(c,k+1)}}}let o=Array.from(s.entries()).sort((h,u)=>u[1].depth-h[1].depth),r=Math.max(...o.map(([,{depth:h}])=>h));for(let[,{depth:h,file:u,outlinks:k}]of o){let d=r-h,g=e.createEl("li",{cls:`inlink inlink-indent-${d}`});if(g.createEl("span",{text:"\u2190 ",cls:"inlink-arrow"}),g.createEl("a",{text:u.basename,cls:"internal-link"}).addEventListener("click",async m=>{m.preventDefault(),m.metaKey||m.ctrlKey?await this.openInNewLeaf(u):this.app.workspace.getLeaf().openFile(u)}),this.toggleTags){let m=await this.cacheLinkData(u);this.renderTags(g,m.tags)}let w=g.createEl("div",{cls:"inlink-attachments"});if(this.toggleAttachments){let m=await this.cacheLinkData(u);await this.renderAttachmentsForOutlink(u,w,m.attachments)}if(k.length>0||this.toggleAttachments&&u){let m=g.createEl("ul",{cls:"inlink-outlinks"});this.outlinksOfInlinksVisible||m.addClass("hidden");for(let E of k){let C=this.app.metadataCache.getFirstLinkpathDest(E,"/");if(C instanceof a.TFile&&C.extension==="md"){let I=m.createEl("li");if(I.createEl("span",{text:"\u2192 "}),I.createEl("a",{text:E,cls:"internal-link"}).addEventListener("click",async L=>{L.preventDefault(),L.metaKey||L.ctrlKey?await this.openInNewLeaf(C):this.app.workspace.getLeaf().openFile(C)}),this.toggleTags){let L=await this.cacheLinkData(C);this.renderTags(I,L.tags)}}}}}return c}async openInNewLeaf(t){await this.app.workspace.getLeaf("tab").openFile(t,{active:!1})}async renderAttachmentsForOutlink(t,e,i){if(!this.toggleAttachments||i.length===0)return;let n=e.createEl("ul",{cls:"outlink-attachments"});for(let s of i){let l=n.createEl("li");l.createEl("span",{text:"\u{1F4CE} "}),l.createEl("a",{text:s,cls:"internal-link"}).addEventListener("click",async o=>{o.preventDefault();let r=this.app.metadataCache.getFirstLinkpathDest(s,t.path);r instanceof a.TFile&&(o.metaKey||o.ctrlKey?await this.openInNewLeaf(r):this.app.workspace.getLeaf().openFile(r))})}}async renderOutlinksIteratively(t,e,i){let n=[{file:t,depth:0,element:e}],s=new Set,l=new Map;for(;n.length>0;){let c=n.shift();if(!c)continue;let{file:o,depth:r,element:h}=c;if(r>=i||o.extension==="canvas"||s.has(o.path))continue;s.add(o.path);let u=await this.cacheLinkData(o);if(u.outlinks.length>0||this.toggleAttachments&&u.attachments.length>0){let k=h.createEl("ul",{cls:"outlink-outlinks"});if(this.toggleAttachments){let d=this.getNewAttachments(o.path,u.attachments,l);d.length>0&&this.renderAttachments(k,d)}for(let d of u.outlinks){let g=this.app.metadataCache.getFirstLinkpathDest(d,o.path);if(g instanceof a.TFile&&!s.has(g.path)){let p=k.createEl("li",{cls:`outlink outlink-depth-${r}`});p.createEl("span",{text:"\u2192 "});let w=p.createEl("a",{text:g.basename,cls:"internal-link"});if(this.toggleTags){let m=await this.cacheLinkData(g);this.renderTags(p,m.tags)}if(w.addEventListener("click",async m=>{m.preventDefault(),m.metaKey||m.ctrlKey?await this.openInNewLeaf(g):this.app.workspace.getLeaf().openFile(g)}),this.toggleAttachments){let m=await this.cacheLinkData(g),E=this.getNewAttachments(g.path,m.attachments,l);if(E.length>0){let C=p.createEl("div",{cls:"outlink-attachments"});this.renderAttachments(C,E)}}n.push({file:g,depth:r+1,element:p})}}}}}getNewAttachments(t,e,i){i.has(t)||i.set(t,new Set);let n=i.get(t),s=e.filter(l=>!n.has(l));return s.forEach(l=>n.add(l)),s}renderCanvasLinks(t,e){let i=t.createEl("li",{cls:"canvas-links"});i.createEl("strong",{text:"Canvas links"});let n=i.createEl("ul");e.forEach(async s=>{let l=n.createEl("li");l.createEl("a",{text:s,cls:"internal-link"}).addEventListener("click",async o=>{o.preventDefault();let r=this.app.metadataCache.getFirstLinkpathDest(`${s}.canvas`,"/");if(!r){let h=this.app.vault.getFiles().filter(u=>u.extension==="canvas"&&u.basename.toLowerCase()===s.toLowerCase());h.length>0&&(r=h[0])}if(r instanceof a.TFile?o.metaKey||o.ctrlKey?await this.openInNewLeaf(r):this.app.workspace.getLeaf().openFile(r):(new a.Notice(`Canvas file not found: ${s}
Tried paths:
- ${s}.canvas`),console.error("Canvas file not found. Link:",s,"Available canvas files:",this.app.vault.getFiles().filter(h=>h.extension==="canvas").map(h=>h.path))),r instanceof a.TFile){let h=await this.cacheLinkData(r);this.renderAttachments(l,h.attachments)}if(this.toggleTags&&r instanceof a.TFile){let h=await this.cacheLinkData(r);this.renderTags(l,h.tags)}})})}adjustLayout_insideExpandedDetailedView(t,e){var u,k;let i=t.getBoundingClientRect(),n=e.getBoundingClientRect(),s=i.width,l=n.width,c=((u=this.inlinksEl)==null?void 0:u.offsetWidth)||0,o=((k=this.outlinksEl)==null?void 0:k.offsetWidth)||0,h=c+l+o>s*.9;t.classList.toggle("link-navigator-compact",h)}setupCacheCleanup(){this.cacheCleanupInterval!==null&&clearInterval(this.cacheCleanupInterval),this.cacheCleanupInterval=setInterval(()=>{this.cleanupCache()},this.settings.cacheCleanupInterval*60*1e3)}cleanupCache(){let t=Date.now(),e=0;for(let[i,n]of this.cache.entries())t-n.timestamp>this.settings.cacheTimeout&&(this.cache.delete(i),e++);e>0&&this.settings.showCacheCleanupNotice&&t-this.lastCleanupNotice>this.CLEANUP_NOTICE_COOLDOWN&&(new a.Notice(`Cleaned up ${e} cache entries.`),this.lastCleanupNotice=t)}showCacheStatus(){let t=this.cache.size,e=this.settings.cacheTimeout/6e4;if(t===0){new a.Notice("Cache is empty.");return}let i=Array.from(this.cache.entries());if(i.length>0){let n=i.sort(([,c],[,o])=>c.timestamp-o.timestamp)[0][1],s=i.sort(([,c],[,o])=>o.timestamp-c.timestamp)[0][1],l=`Cache size: ${t} entries
Cache timeout: ${e} minutes
Oldest entry: ${n!=null&&n.timestamp?new Date(n.timestamp).toLocaleString():"N/A"}
Newest entry: ${s!=null&&s.timestamp?new Date(s.timestamp).toLocaleString():"N/A"}
Dirty cache entries: ${this.dirtyCache.size}`;new a.Notice(l)}else new a.Notice("Cache is empty.")}rebuildCache(){this.cache.clear(),this.dirtyCache.clear(),this.loadingPromises.clear();let t=this.app.vault.getFiles();for(let e of t)this.updateLinkNavigation(e);new a.Notice("Cache has been rebuilt.")}invalidateCache(t){this.cache.delete(t.path),this.dirtyCache.add(t.path)}updateDetailedView(){let t=this.app.workspace.getActiveFile(),e=this.app.workspace.getActiveViewOfType(a.MarkdownView);t&&e&&this.detailsEl&&this.renderDetailedView(this.detailsEl,t)}},x=class extends a.PluginSettingTab{constructor(t,e){super(t,e);this.plugin=e}display(){let{containerEl:t}=this;t.empty(),t.createEl("h2",{text:"Link Display Settings"}),new a.Setting(t).setName("Inlink format").setDesc('Format for inlink display. Use {label}, {count}, {arrow}, and {icon}. Example: "{arrow} {label} ({count})" might display as " \u21E6 Inlinks (5)').addText(e=>e.setPlaceholder("{arrow} {label} ({count})").setValue(this.plugin.settings.inlinkFormat).onChange(async i=>{this.plugin.settings.inlinkFormat=i,await this.plugin.saveSettings()})),new a.Setting(t).setName("Inlink {icon}").setDesc("Select a Lucide icon to represent inlinks.").addText(e=>{this.plugin.inlinkIconTextComponent=e,e.setPlaceholder("Icon ID").setValue(this.plugin.settings.inlinkIcon).onChange(async i=>{this.plugin.settings.inlinkIcon=i,await this.plugin.saveSettings()}),e.inputEl.setAttribute("data-setting-id","inlinkIcon")}).addButton(e=>{e.setIcon("search").setTooltip("Pick icon").onClick(()=>{this.plugin.inlinkIconTextComponent?new y(this.app,this.plugin,"inlinkIcon",this.plugin.inlinkIconTextComponent).open():console.error("Inlink Icon TextComponent is not initialized.")})}),new a.Setting(t).setName("Inlink {label}").setDesc('Text for the inlink label (e.g., "Inlinks").').addText(e=>e.setPlaceholder("INLINKS").setValue(this.plugin.settings.inlinkText).onChange(async i=>{this.plugin.settings.inlinkText=i,await this.plugin.saveSettings()})),new a.Setting(t).setName("Inlink {arrow}").setDesc("Character to use as the inlink arrow.").addText(e=>e.setPlaceholder("\u2190").setValue(this.plugin.settings.inlinkArrow).onChange(async i=>{this.plugin.settings.inlinkArrow=i,await this.plugin.saveSettings()})),new a.Setting(t).setName("Show inlink count").setDesc("Display the number of inlinks.").addToggle(e=>e.setValue(this.plugin.settings.showInlinkCount).onChange(async i=>{this.plugin.settings.showInlinkCount=i,await this.plugin.saveSettings()})),new a.Setting(t).setName("Inlink custom CSS class").setDesc("Add custom CSS classes to inlink elements (space separated). E.g.: `custom-inlink-class` then in your custom CSS snippet you could use this custom CLASS to further style you inlink. ").addText(e=>e.setPlaceholder("custom-inlink-class").setValue(this.plugin.settings.inlinkCustomClass).onChange(async i=>{this.plugin.settings.inlinkCustomClass=i,await this.plugin.saveSettings()})),new a.Setting(t).setName("Outlink format").setDesc("Format for outlink display. Use {label}, {count}, {arrow}, and {icon}.").addText(e=>e.setPlaceholder("{label} ({count}) {arrow}").setValue(this.plugin.settings.outlinkFormat).onChange(async i=>{this.plugin.settings.outlinkFormat=i,await this.plugin.saveSettings()})),new a.Setting(t).setName("Outlink icon").setDesc("Select a Lucide icon to represent outlinks.").addText(e=>{this.plugin.outlinkIconTextComponent=e,e.setPlaceholder("Icon ID").setValue(this.plugin.settings.outlinkIcon).onChange(async i=>{this.plugin.settings.outlinkIcon=i,await this.plugin.saveSettings()}),e.inputEl.setAttribute("data-setting-id","outlinkIcon")}).addButton(e=>{e.setIcon("search").setTooltip("Pick icon").onClick(()=>{this.plugin.outlinkIconTextComponent?new y(this.app,this.plugin,"outlinkIcon",this.plugin.outlinkIconTextComponent).open():console.error("Outlink Icon TextComponent is not initialized.")})}),new a.Setting(t).setName("Outlink label").setDesc('Text for the outlink label (e.g., "Outlinks").').addText(e=>e.setPlaceholder("OUTLINKS").setValue(this.plugin.settings.outlinkText).onChange(async i=>{this.plugin.settings.outlinkText=i,await this.plugin.saveSettings()})),new a.Setting(t).setName("Outlink arrow").setDesc("Character to use as the outlink arrow.").addText(e=>e.setPlaceholder("\u2192").setValue(this.plugin.settings.outlinkArrow).onChange(async i=>{this.plugin.settings.outlinkArrow=i,await this.plugin.saveSettings()})),new a.Setting(t).setName("Show outlink count").setDesc("Display the number of outlinks.").addToggle(e=>e.setValue(this.plugin.settings.showOutlinkCount).onChange(async i=>{this.plugin.settings.showOutlinkCount=i,await this.plugin.saveSettings()})),new a.Setting(t).setName("Outlink custom CSS class").setDesc("Add custom CSS classes to outlink elements (space separated). . E.g.: `custom-outlink-class` then in your custom CSS snippet you could use this custom CLASS to further style you outlink. ").addText(e=>e.setPlaceholder("custom-outlink-class").setValue(this.plugin.settings.outlinkCustomClass).onChange(async i=>{this.plugin.settings.outlinkCustomClass=i,await this.plugin.saveSettings()})),t.createEl("h2",{text:"General Settings"}),new a.Setting(t).setName("Enable Canvas Links Toggle").setDesc("Show the toggle button for Canvas links in the detailed view.").addToggle(e=>e.setValue(this.plugin.settings.isCanvasLinksEnabled).onChange(async i=>{await this.plugin.updateSettings({isCanvasLinksEnabled:i})})),new a.Setting(t).setName("Enable Attachments Toggle").setDesc("Show the toggle button for attachments in the detailed view.").addToggle(e=>e.setValue(this.plugin.settings.isAttachmentsEnabled).onChange(async i=>{await this.plugin.updateSettings({isAttachmentsEnabled:i})})),new a.Setting(t).setName("Enable Tags Toggle").setDesc("Show the toggle button for tags in the detailed view.").addToggle(e=>e.setValue(this.plugin.settings.isTagsEnabled).onChange(async i=>{await this.plugin.updateSettings({isTagsEnabled:i})})),new a.Setting(t).setName("Cache timeout").setDesc("How long (in minutes) to keep link data in the cache before refreshing.  Higher values reduce CPU usage but may show slightly outdated information.").addText(e=>e.setPlaceholder("Enter cache timeout").setValue((this.plugin.settings.cacheTimeout/6e4).toString()).onChange(async i=>{let n=parseInt(i)*6e4;!isNaN(n)&&n>0&&(this.plugin.settings.cacheTimeout=n,await this.plugin.saveSettings())})),new a.Setting(t).setName("Cache cleanup interval").setDesc("How often (in minutes) to automatically clean up old entries in the cache.").addText(e=>e.setPlaceholder("Enter cache cleanup interval (minutes)").setValue(this.plugin.settings.cacheCleanupInterval.toString()).onChange(async i=>{let n=parseInt(i);!isNaN(n)&&n>0&&(this.plugin.settings.cacheCleanupInterval=n,await this.plugin.saveSettings(),this.plugin.setupCacheCleanup())})),new a.Setting(t).setName("Cache status").setDesc("View the current size and status of the link cache.").addButton(e=>{e.setButtonText("Show cache status").onClick(()=>{this.plugin.showCacheStatus()})}),new a.Setting(t).setName("Rebuild cache").setDesc("Manually rebuild the link cache. This can be useful if you suspect the cache is corrupted or out of sync.").addButton(e=>{e.setButtonText("Rebuild cache").onClick(()=>{this.plugin.rebuildCache()})}),new a.Setting(t).setName("Show cache cleanup notice").setDesc("Display a brief notification when the cache is automatically cleaned.").addToggle(e=>e.setValue(this.plugin.settings.showCacheCleanupNotice).onChange(async i=>{this.plugin.settings.showCacheCleanupNotice=i,await this.plugin.saveSettings()}))}};

/* nosourcemap */