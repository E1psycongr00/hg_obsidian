---
tags:
  - OS
  - Process
  - Synchronization
aliases:
  - Semaphore
---
작성 날짜: 2024-01-16
작성 시간: 21:46

## 주제: #미완 #OS #Process #Synchronization 

----
## 내용(Content)
### 세마포어란
>[!summary] 세마포어
>하나 또는 여러 프로세스/스레드가 critical section에 접근 가능하도록 하도록 하는 시그널 메커니즘이다.

### wait와 signal

세마포어의 개념을 수도 코드를 통해 살펴보자

```text
class Semaphore {
	int value = 5;
	int guard = 0;
}

Semaphore::wait() {
	while (test_and_set(&guard)) {
		if (value == 0) {
			쓰레드를 Block하고 큐에 넣는다
		} else {
			value -= 1;
			guard = 0;
		}
	}
}

Semaphore::signal() {
	while(test_and_set(&guard)) {
		if (Block된 쓰레드가 존재) {
			Block된 쓰레드를 가져와서 깨운다 in blockedThreadQueue;
		} else {
			value += 1;
		}
		guard = 0;
	}

}
```

위의 수도 코드를 기준으로 wait와 signal이 무엇인지 분석해보자

**wait**는 value가 0이면 Semaphore가 받을 수 있는 쓰레드를 초과한다. 그렇기에 Thread를 중지하고 큐에 보관한다. 받을 수 있는 경우에는 value를 감소시키고 그대로 쓰레드를 동작시킨다. 


**signal**의 경우 value를 +1해서 세마포어가 허용할 수 있는 쓰레드 수를 늘린다. 그러나 그 이전에 대기중인 Block된 쓰레드가 큐에 있다면 그들을 가져와서 깨워서 Thread가 동작할 수 있도록 한다.

### 세마포어 동작 원리
세마포어는 쓰레드의 검문소라 이해하면 편하다. 공유된 영역에는 한정된 쓰레드만 들어올 수 있고, 한계를 초과한 경우에는 더 이상 들여보내지 않고 대기한다.  그러나 쓰레드가 나가는 경우, 추가로 들여 보내줄 수 있는데 이 때 대기했던 자들을 다시 공무대로 처리해서 들여보낸다.

군대 면회를 예시로 생각해보자

![[세마포어 wait 호출 전 예시(draw)]]



### 세마포어 종류

- 바이너리 세마포어
	- value = 1
	- 상호 배제 조건을 만들어줌(Mutex와 유사)
- 카운팅 세마포어
	- value > 1
	- 여러 프로세스/쓰레드가 해당 자원에 접근 가능

## 질문 & 확장

(없음)

## 출처(링크)
- https://drcode-devblog.tistory.com/297
- https://www.youtube.com/watch?v=gTkvX2Awj6g
- https://mini98.tistory.com/71#Reference
## 연결 노트
- [[Spin Lock (스핀 락)]]
- [[뮤텍스(Mutex)]]
- [[Java에서 Mutex 사용 예제]]







