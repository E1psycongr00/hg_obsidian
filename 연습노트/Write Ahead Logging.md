---
tags:
  - 미완
  - MSA
aliases:
  - WAL
date: 2024-12-18
title: Write Ahead Logging
---
---

## 내용(Content)

### WAL (Write Ahead Logging)

WAL(Write-Ahead Logging)은 **트랜잭션 처리 시스템**이나 **데이터베이스 시스템**에서 데이터 일관성과 복구를 보장하기 위한 중요한 기법이다. WAL은 트랜잭션의 모든 변경 내용을 실제 데이터베이스에 반영하기 전에 **로그에 먼저 기록**함으로써 시스템이 장애 발생 시에도 복구할 수 있도록 한다. ^9ef1f5

### WAL의 핵심 개념

- **로그 선 기록 원칙**:  
    트랜잭션에서 발생한 변경 사항은 실제 데이터를 수정하기 전에 로그 파일에 기록된다.  
    이 원칙은 데이터가 손상되거나 장애가 발생했을 때, 로그를 통해 데이터를 복구할 수 있도록 한다.
    
- **장애 복구 지원**:  
    WAL은 트랜잭션 중간에 시스템이 충돌하더라도, 로그를 사용하여 트랜잭션을 재실행(redo)하거나 롤백(undo)할 수 있는 기반을 제공한다.
    
- **일관성 보장**:  
    WAL은 데이터베이스의 ACID(Atomicity, Consistency, Isolation, Durability) 속성을 보장하기 위한 필수적인 구성 요소이다.

### WAL의 작동 원리

WAL은 크게 두 가지 주요 단계로 작동한다.

#### 2.1. **로그 기록**

- 트랜잭션이 시작되면, 변경 내용이 데이터베이스 파일에 반영되기 전에 로그에 먼저 기록된다.
- 로그에는 다음과 같은 정보가 포함된다:
    - 트랜잭션 ID
    - 변경 전 데이터 값 (undo 정보)
    - 변경 후 데이터 값 (redo 정보)

#### 2.2. **로그 적용**

- 시스템 장애가 발생한 경우, WAL 로그를 사용하여 다음과 같은 방식으로 데이터를 복구한다:
    1. **Redo**: 장애 전에 커밋된 트랜잭션의 변경 사항을 재적용하여 데이터베이스를 복원한다.
    2. **Undo**: 커밋되지 않은 트랜잭션의 변경 사항을 롤백하여 데이터베이스의 일관성을 유지한다.

### WAL의 특징

1. **내구성(Durability) 보장**
    
    - 커밋된 트랜잭션은 로그를 통해 영구적으로 기록되므로, 시스템 장애 이후에도 데이터를 복구할 수 있다.
2. **순차적인 쓰기 작업**
    
    - 로그는 디스크에 순차적으로 기록되므로 랜덤 쓰기 작업보다 효율적이다. 이는 I/O 성능을 크게 향상시킨다.
3. **효율적인 장애 복구**
    
    - 로그를 통해 복구가 가능하므로 데이터베이스의 가용성과 안정성이 높아진다.

### WAL의 장점과 단점

**장점**

- 장애 복구 및 데이터 일관성 보장.
- 디스크 I/O 성능 최적화(순차 쓰기).
- 트랜잭션 롤백 및 재실행이 용이.

**단점**

- 로그를 유지하고 관리하는 데 추가적인 스토리지와 성능 오버헤드가 발생한다.
- 로그 파일 크기가 커지면 복구 시간이 길어질 수 있다.


## 질문 & 확장

- WAL이 데이터베이스 성능에 미치는 영향은 무엇인가?
    - 순차 쓰기를 통한 성능 최적화에도 불구하고, 로그 관리 비용은 성능에 부담이 될 수 있다.
- WAL을 사용하는 시스템의 장애 복구 시간을 최적화하려면 어떻게 해야 하는가?
    - 체크포인트(Checkpoint)를 도입하여 로그 크기를 줄이고 복구 시간을 단축할 수 있다.
- WAL과 다른 장애 복구 기법(예: Shadow Paging)은 어떻게 비교되는가?

## 출처(링크)

- Hector Garcia-Molina et al., _Database Systems: The Complete Book_
- [MySQL :: MySQL 8.0 Reference Manual :: 17.1 Introduction to InnoDB](https://dev.mysql.com/doc/refman/8.0/en/innodb-introduction.html)
- [PostgreSQL: Documentation: 17: 28.3. Write-Ahead Logging (WAL)](https://www.postgresql.org/docs/current/wal-intro.html)

## 연결 노트










