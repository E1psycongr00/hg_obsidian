## 내용

### SAGA란 무엇인가?

SAGA는 분산 시스템에서 **데이터의 일관성과 원자성을 유지하기 위해 설계된 트랜잭션 관리 패턴**이다[^1]. SAGA는 트랜잭션을 여러 개의 소규모 단계로 분할하여 각 단계를 독립적으로 커밋하고, 오류가 발생할 경우 해당 단계에 대응하는 보상 작업(compensating action)을 수행하여 시스템의 일관성을 유지한다. 이는 특히 **마이크로서비스 아키텍처**와 같은 분산 환경에서 유용하다.

### SAGA의 주요 개념

1. **단일 트랜잭션의 분할**  
   SAGA는 큰 트랜잭션을 여러 개의 작은 "로컬 트랜잭션"으로 나누며, 각 트랜잭션은 자체적으로 커밋될 수 있다. 따라서 전통적인 데이터베이스의 분산 트랜잭션처럼 **2단계 커밋(two-phase commit, 2PC)**을 사용하지 않는다[^2]. 이 방식은 분산 시스템의 성능 저하와 복잡성을 줄여준다.

2. **보상 트랜잭션(Compensating Transaction)**  
   SAGA는 실패를 처리하기 위해 각 트랜잭션에 대해 "보상 트랜잭션"을 정의한다. 보상 트랜잭션은 앞서 커밋된 작업을 취소(undo)하거나 역방향으로 되돌리는 역할을 한다. 예를 들어, 결제 완료 후 오류가 발생한 경우 환불 처리가 보상 트랜잭션이 될 수 있다.

3. **조정(Coordinator)**  
   SAGA의 실행은 중앙 집중화된 조정자(coordinator)에 의해 관리되거나, 각 서비스가 이벤트를 통해 비동기적으로 상태를 공유하며 관리될 수 있다.  
   - **중앙 집중형 SAGA(Coordinated SAGA):** 조정자가 트랜잭션 순서와 상태를 관리한다.  
   - **분산형 SAGA(Choreographed SAGA):** 각 서비스가 이벤트 기반 메시지를 교환하며 독립적으로 상태를 관리한다.

### SAGA의 작동 방식

SAGA는 크게 두 가지 전략으로 작동한다[^3]:

1. **순차적 실행(Step-by-Step Execution)**  
   트랜잭션이 순차적으로 실행되며, 오류가 발생할 경우 바로 보상 작업이 실행된다. 아래는 예제이다:
   - 단계 1: 주문 생성 (성공)  
   - 단계 2: 결제 처리 (성공)  
   - 단계 3: 재고 감소 (실패 → 결제 환불)  

2. **병렬 실행(Concurrent Execution)**  
   상호 독립적인 트랜잭션이 병렬로 실행될 수 있다. 이 경우, 병렬 실행 중 오류가 발생하면 영향을 받은 트랜잭션만 보상한다.

### SAGA의 장점과 한계

1. **장점**  
   - **높은 성능:** 분산 트랜잭션을 사용하는 대신 로컬 트랜잭션을 활용하여 성능을 개선한다.  
   - **확장성:** 마이크로서비스 환경에서 서비스 간 느슨한 결합을 보장한다.  
   - **일관성 유지:** 보상 트랜잭션을 통해 분산 환경에서도 데이터 일관성을 유지한다.

2. **한계**  
   - **복잡성:** 보상 트랜잭션을 설계하는 데 많은 노력과 추가 코드가 필요하다.  
   - **부분 실패 허용:** 분산 환경에서는 완벽한 원자성(atomicity)을 보장하기 어렵다.  
   - **지연:** 트랜잭션의 순차적 실행 또는 실패 복구로 인해 지연이 발생할 수 있다.

---

## 질문 & 확장

1. SAGA 패턴을 사용하는 대신 **2단계 커밋(2PC)**을 선택해야 하는 경우는 어떤 상황인가?  
2. SAGA의 병렬 실행 방식에서 트랜잭션 충돌(conflict)을 방지하는 방법은 무엇인가?  
3. 마이크로서비스 아키텍처 외에도 SAGA 패턴이 활용될 수 있는 다른 응용 분야는 무엇인가?  
4. SAGA와 관련된 대표적인 **오픈소스 프레임워크**(e.g., Axon, Eventuate, Netflix Conductor)의 특징은 무엇인가?  

---

## 출처

[^1]: Hector Garcia-Molina, Kenneth Salem, "SAGA: A System for Managing Long Running Transactions," ACM Transactions on Database Systems, 1987, Vol. 12, Issue 3, p. 299.  

    > "A Saga is a long-running transaction that is composed of a sequence of smaller transactions that can be interleaved with other transactions."  

    SAGA의 기본 개념과 정의를 설명하는 최초의 논문으로, SAGA가 트랜잭션 관리 문제를 해결하는 데 유용한 패턴임을 설명.

[^2]: Martin Kleppmann, *Designing Data-Intensive Applications*, O'Reilly Media, Chapter 11, p. 386.  

    > "In distributed systems, sagas are often preferred over two-phase commit as they avoid locking resources for extended periods."  

    2단계 커밋과 SAGA의 차이를 설명하며 SAGA가 왜 더 유용한지 강조.

[^3]: Chris Richardson, "Microservices Patterns: With examples in Java," Manning Publications, 2019, Chapter 4, p. 104.  

    > "Sagas coordinate distributed transactions by breaking them into smaller, independently managed steps, enabling greater scalability and reliability."  

    SAGA의 작동 방식과 패턴을 분산 환경에서의 트랜잭션 관리와 연관지어 설명.  
